<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/ui.css">

</head>

<body>
    <nav>
        <h1>Testing Chat App! </h1>
        <h2>Input input input</h2>
        <p> Who knows what the future of messaging will be after this app!</p>
    </nav>

    <div class="container">


        <div class="maincontent">
            <h1> Chat</h1>
            <p> Welcome to the test bed for the future of online communication</p>

            <ul id="messages"> </ul>

            <form id="form">
                <input id="input" autocomplete="off" />
                <button> Send </button>

            </form>
            <br>

            <input id="namedata" placeholder="Please input your name" />
            <button id="namebutton" type="button"> Update </button>

            <div>
                <br> <br>
                <input id="numData" placeholder="Please input a number" />
                <button id="numButton" type="button"> Update </button>
            </div>



        </div>

        <div class="playerCount">
            <h1> Players</h1>
            <p> Active Players right now </p>

            <ul id="players"> </ul>



        </div>


    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        const form = document.getElementById("form");
        const input = document.getElementById("input");
        const messages = document.getElementById("messages");
        const getnamebutton = document.getElementById("namebutton");
        const getnamedata = document.getElementById("namedata");

        const getNumButton = document.getElementById("numButton");
        const getNumData = document.getElementById("numData");

        getNumButton.addEventListener("click", () => {
            let numEntered = (Math.floor(Math.random() * getNumData.value));
            console.log(numEntered);
            getNumButton.insertAdjacentHTML("afterend", `<br>You rolled : ${numEntered} </div>`);
            socket.emit("numUpdate", numEntered);
        })



        getnamebutton.addEventListener("click", () => {
            let nameEntered = getnamedata.value;
            getnamebutton.insertAdjacentHTML("afterend", `<div>  Your name is: ${nameEntered} </div>`);
            socket.emit("nameUpdate", nameEntered);

        });

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const text = input.value.trim();
            if (!text) return;
            socket.emit("messageSend", text);
            input.value = "";
        });

        socket.on("messageSend", (text) => {
            const li = document.createElement("li");
            li.textContent = text;
            messages.appendChild(li);

        });

        socket.on("newUser", (userId, userList) => {
            players.innerHTML = "";
            console.log(userList);
            userList.forEach(user_id => {
                const li = document.createElement("li");
                li.textContent = user_id;
                players.appendChild(li);
            });


        });

        socket.on("disconnected", (userId, userList) =>{
            players.innerHTML = "";
            console.log(userList);
            userList.forEach(user_id => {
                const li = document.createElement("li");
                li.textContent = user_id;
                players.appendChild(li);
            });

         
        })



    </script>


</body>

</html>